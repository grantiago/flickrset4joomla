<?xml version="1.0" encoding="UTF-8"?>
<project name="flickrset4joomla" default="release-all" basedir=".">
    <description>Builds the joomla package project "flickrset4joomla".</description>
    
    <property file="build.properties" />
    
    <tstamp>
        <format property="TODAY_BE" pattern="MMMM d ,YYYY" locale="nl,BE"/>
    </tstamp>
    
    <property name="project-name" value="${ant.project.name}" />
    <property name="packages-folder" value="packages" />

    <property name="flickrset_plugin-name" value="flickrset_plugin" />
    <property name="flickrset_plugin-folder-to-zip" value="${packages-folder}\${flickrset_plugin-name}" />
    <property name="flickrset_plugin-destfile" value="${flickrset_plugin-name}_v${flickrset_plugin-version}.zip" /> 
    
    <property name="add_flickrset_btn_plugin-name" value="add_flickrset_btn_plugin" />
    <property name="add_flickrset_btn_plugin-folder-to-zip" value="${packages-folder}\${add_flickrset_btn_plugin-name}" /> 
    <property name="add_flickrset_btn_plugin-destfile" value="${add_flickrset_btn_plugin-name}_v${add_flickrset_btn_plugin-version}.zip" /> 
    
    <property name="package-name" value="${project-name}_pkg" />
    <property name="flickrset4joomla_pkg-destfile" value="${package-name}_v${package-version}.zip" /> 
    
    <property name="release-version-dir" value="../releases/REL${flickrset_release-version}" />
    
    <target name="zip-flickrset_plugin" description="Generate the zipped file for flickrset_plugin.">
        <property name="flickrset_plugin-xml_file" value="flickrset.xml" />
        
        <copy file="../${flickrset_plugin-folder-to-zip}/${flickrset_plugin-xml_file}" preservelastmodified="" todir="../.." outputencoding="UTF-8" />
        
        <replace file="../../${flickrset_plugin-xml_file}" token="flickrset_plugin_version_creation_date" value="${TODAY_BE}" />
        <replace file="../../${flickrset_plugin-xml_file}" token="flickrset_plugin_version" value="${flickrset_plugin-version}" />
        
        <zip destfile="../../${flickrset_plugin-destfile}" excludes="dont*.*">
            <zipfileset dir="../${flickrset_plugin-folder-to-zip}" excludes="${flickrset_plugin-xml_file}" />
            <zipfileset dir="../.." includes="${flickrset_plugin-xml_file}" />
        </zip>
        
        <delete file="../../${flickrset_plugin-xml_file}" />
    </target>
    
    <target name="release-flickrset_plugin" description="Release the zipped file for flickrset_plugin." depends="zip-flickrset_plugin" >
        <move file="../../${flickrset_plugin-destfile}" preservelastmodified="yes" todir="${release-version-dir}" />
    </target>
    
    <target name="zip-add_flickrset_btn_plugin" description="Generate the zipped file for add_flickrset_btn_plugin.">
        <property name="add_flickrset_btn_plugin-xml_file" value="add_flickrset_btn.xml" />
        
        <copy file="../${add_flickrset_btn_plugin-folder-to-zip}/${add_flickrset_btn_plugin-xml_file}" preservelastmodified="" todir="../.." outputencoding="UTF-8" />
        
        <replace file="../../${add_flickrset_btn_plugin-xml_file}" token="add_flickrset_btn_plugin_version_creation_date" value="${TODAY_BE}" />
        <replace file="../../${add_flickrset_btn_plugin-xml_file}" token="add_flickrset_btn_plugin_version" value="${flickrset_plugin-version}" />
        
        <zip destfile="../../${add_flickrset_btn_plugin-destfile}" excludes="dont*.*">
            <zipfileset dir="../${add_flickrset_btn_plugin-folder-to-zip}" excludes="${add_flickrset_btn_plugin-xml_file}" />
            <zipfileset dir="../.." includes="${add_flickrset_btn_plugin-xml_file}" />
        </zip>
      
        <delete file="../../${add_flickrset_btn_plugin-xml_file}" />
    </target>
    
    <target name="release-add_flickrset_btn_plugin" description="Release the zipped file for add_flickrset_btn_plugin." depends="zip-add_flickrset_btn_plugin" >
        <move file="../../${add_flickrset_btn_plugin-destfile}" preservelastmodified="yes" todir="${release-version-dir}" />
    </target>

    <target name="zip-flickrset4joomla_pkg" description="Generate the zipped file for flickrset package." depends="zip-flickrset_plugin,zip-add_flickrset_btn_plugin">
        <property name="flickrset4joomla_pkg-xml_file" value="pkg_flickrset.xml" />
        
        <copy file="../${flickrset4joomla_pkg-xml_file}" preservelastmodified="yes" todir="../.." outputencoding="UTF-8" />
        
        <replace file="../../${flickrset4joomla_pkg-xml_file}" token="package_version_creation_date" value="${TODAY_BE}" />
        <replace file="../../${flickrset4joomla_pkg-xml_file}" token="package_version" value="${package-version}" />
        <replace file="../../${flickrset4joomla_pkg-xml_file}" token="flickrset_plugin_zip_file" value="${flickrset_plugin-destfile}" />
        <replace file="../../${flickrset4joomla_pkg-xml_file}" token="add_flickrset_btn_plugin_zip_file" value="${add_flickrset_btn_plugin-destfile}" />
        
        <zip destfile="../../${flickrset4joomla_pkg-destfile}" excludes="dont*.*">
            <zipfileset dir="../.." includes="${flickrset4joomla_pkg-xml_file}" />
            <zipfileset dir="../language" prefix="language" />
            <zipfileset dir="../.." includes="${flickrset_plugin-destfile}" />
            <zipfileset dir="../.." includes="${add_flickrset_btn_plugin-destfile}" />
        </zip>
        
        <delete file="../../${flickrset_plugin-destfile}" />
        <delete file="../../${add_flickrset_btn_plugin-destfile}" />
        <delete file="../../${flickrset4joomla_pkg-xml_file}" />
        
    </target>
    
    <target name="release-flickrset4joomla_pkg" description="Release the zipped file for flickrset package." depends="zip-flickrset4joomla_pkg" >
        <move file="../../${flickrset4joomla_pkg-destfile}" preservelastmodified="yes" todir="${release-version-dir}" />
    </target>
    
    <target name="release-all" description="Release plugins/package" depends="release-flickrset_plugin,release-add_flickrset_btn_plugin,release-flickrset4joomla_pkg" />
    
</project>
